#!/usr/bin/env sh

PRIMARY=`tput setaf 6; tput bold`
HIGHLIGHT=`tput setaf 5; tput bold`
TITLE=`tput setaf 0; tput bold; tput smul`
STOP=`tput rmul; tput sgr0`
DIM=`tput dim`
NC=`tput sgr0; tput rmul`

echo;
echo "$TITLE                             ENVIRONMENT CONTAINERS                             $STOP"
echo;

while read line || [[ -n ${line} ]]
do
    if ! [[ ${WORKON_HOME}/${line} == ${VIRTUAL_ENV} ]]; then
        workon ${line};
        echo work on ${RED}${line}${NC};
    fi
done < .venv

nvm use > /dev/null
echo Using NPM ${RED}`nvm current`${NC}

echo;
echo;
echo "$TITLE                             ENVIRONMENT VARIABLES                              $STOP"
echo;

export PYTHONPATH=$PWD
echo export ${PRIMARY}PYTHONPATH${NC}=${DIM}$PWD${NC}

while read line || [[ -n ${line} ]]
do
    export ${line}
    echo export ${line\
}        | awk -F " |=" '{ gsub(/[a-zA-Z]/, "_", $3) }
                        { gsub(/[0-9]/, "#", $3) }
                        { print $1, $2, $3}'\
        | while read A B C; do echo "$NC$A $HIGHLIGHT$B$NC=$DIM$C$NC"; done\
        | cut -c 1-115
done < ./.env

echo ${NC};
echo;
echo "$TITLE                             ENVIRONMENT ALIASES                                $STOP"
echo;

alias  req="pip-compile requirements/local.in &\
            pip-compile requirements/production.in &\
            pip-compile requirements/test.in &\
            wait"
echo "alias ${PRIMARY}req$NC            ${DIM}Build requirements files for 'pip'.$NC"

alias dev='req && pip-sync requirements/local.txt'
echo "alias ${PRIMARY}dev$NC            ${DIM}Run $NC${PRIMARY}req$NC${DIM} and Sync local requirements.$NC"

alias cov='coverage run manage.py test -v 2 --settings config.settings.test && coverage html && serve:cov'
echo "alias ${PRIMARY}cov$NC            ${DIM}Build coverage report and$NC ${PRIMARY}serve$NC"

alias serve='django-admin runserver_plus'
echo "alias ${PRIMARY}serve$NC          ${DIM}Run Django dev server.$NC"

alias serve:watch='django-admin runserver_plus --extra-file=pubmed/templates/flat_form/{*/,}*.html'
echo "alias ${PRIMARY}serve:watch$NC    ${DIM}Run Django dev server. Watch 'pubmed' templates.$NC"

alias serve:cov='gulp serve:cov'
echo "alias ${PRIMARY}serve:cov$NC      ${DIM}Serve coverage HTML pages.$NC"


echo ${NC}
